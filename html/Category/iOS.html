<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  iOS开发 - 奉强的个人博客
  
  </title>
 <meta name="description" content="奉强的技术博客，全栈开发。">
 <link href="atom.xml" rel="alternate" title="奉强的个人博客" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">奉强的个人博客</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 奉强的个人博客</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>杂类</label></li>

          
            <li><a title="基于docker搭建lanproxy内网穿透服务" href="15229403526064.html">基于docker搭建lanproxy内网穿透服务</a></li>
          
            <li><a title="手摸手教程 之 教你搭建自己的静态博客" href="14993449096811.html">手摸手教程 之 教你搭建自己的静态博客</a></li>
          
            <li><a title="我的2016" href="14854433400635.html">我的2016</a></li>
          
            <li><a title="支付宝怎么免手续费提现" href="14786196059653.html">支付宝怎么免手续费提现</a></li>
          
            <li><a title="怎么用自己的域名建立一个个人博客" href="14607325165802.html">怎么用自己的域名建立一个个人博客</a></li>
          
            <li><a title="嵌入式和单片机的学习心得" href="14939112243125.html">嵌入式和单片机的学习心得</a></li>
          

      
        <li class="divider"></li>
        <li><label>iOS开发</label></li>

          
            <li><a title="iOS逆向开发笔记1--工具篇" href="14854248394653.html">iOS逆向开发笔记1--工具篇</a></li>
          
            <li><a title="Swift3入门教程之二----函数和闭包" href="14758321095435.html">Swift3入门教程之二----函数和闭包</a></li>
          
            <li><a title="Swift3入门教程之一基础部分" href="14758046879967.html">Swift3入门教程之一基础部分</a></li>
          
            <li><a title="iOS开发-如何优雅地集成支付宝支付功能" href="14702334322974.html">iOS开发-如何优雅地集成支付宝支付功能</a></li>
          
            <li><a title="iOS开发中，m3u8格式视频的下载缓存" href="14685880528825.html">iOS开发中，m3u8格式视频的下载缓存</a></li>
          
            <li><a title="git中，如何使用sourcetree管理同一个项目中的多个远程仓库" href="14634059724558.html">git中，如何使用sourcetree管理同一个项目中的多个远程仓库</a></li>
          
            <li><a title="iOS开发-坑爹的iOS特性" href="14611524452165.html">iOS开发-坑爹的iOS特性</a></li>
          
            <li><a title="iOS开发-打通UIWebView和WKWebView的Cookie" href="14611518603473.html">iOS开发-打通UIWebView和WKWebView的Cookie</a></li>
          
            <li><a title="iOS开发-apple pay的实际应用" href="14611508828436.html">iOS开发-apple pay的实际应用</a></li>
          
            <li><a title="iOS开发-navigationBar的透明度处理" href="14610809561335.html">iOS开发-navigationBar的透明度处理</a></li>
          
            <li><a title="iOS开发-AVPlayer的缓存问题" href="14608134723455.html">iOS开发-AVPlayer的缓存问题</a></li>
          
            <li><a title="iOS开发-OC可选参数函数" href="14608131201401.html">iOS开发-OC可选参数函数</a></li>
          
            <li><a title="iOS开发-FMDB多线程安全问题" href="14608133210368.html">iOS开发-FMDB多线程安全问题</a></li>
          

      
        <li class="divider"></li>
        <li><label>Python</label></li>

          
            <li><a title="一个导出qq音乐歌单的小工具" href="14913069118493.html">一个导出qq音乐歌单的小工具</a></li>
          
            <li><a title="Python学习笔记-函数的使用" href="14890625223406.html">Python学习笔记-函数的使用</a></li>
          
            <li><a title="Python学习笔记-基础篇" href="14695444360650.html">Python学习笔记-基础篇</a></li>
          

      
        <li class="divider"></li>
        <li><label>OpenCV</label></li>

          
            <li><a title="苍老师的 "码" 是怎么打上的" href="15090278092045.html">苍老师的 "码" 是怎么打上的</a></li>
          

      
        <li class="divider"></li>
        <li><label>Java</label></li>

          
            <li><a title="JAVA动态代理" href="15377761043880.html">JAVA动态代理</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>杂类</span></li>
                        
                          <li><a title="基于docker搭建lanproxy内网穿透服务" href="15229403526064.html">基于docker搭建lanproxy内网穿透服务</a></li>
                        
                          <li><a title="手摸手教程 之 教你搭建自己的静态博客" href="14993449096811.html">手摸手教程 之 教你搭建自己的静态博客</a></li>
                        
                          <li><a title="我的2016" href="14854433400635.html">我的2016</a></li>
                        
                          <li><a title="支付宝怎么免手续费提现" href="14786196059653.html">支付宝怎么免手续费提现</a></li>
                        
                          <li><a title="怎么用自己的域名建立一个个人博客" href="14607325165802.html">怎么用自己的域名建立一个个人博客</a></li>
                        
                          <li><a title="嵌入式和单片机的学习心得" href="14939112243125.html">嵌入式和单片机的学习心得</a></li>
                        

                    
                      <li class="side-title"><span>iOS开发</span></li>
                        
                          <li><a title="iOS逆向开发笔记1--工具篇" href="14854248394653.html">iOS逆向开发笔记1--工具篇</a></li>
                        
                          <li><a title="Swift3入门教程之二----函数和闭包" href="14758321095435.html">Swift3入门教程之二----函数和闭包</a></li>
                        
                          <li><a title="Swift3入门教程之一基础部分" href="14758046879967.html">Swift3入门教程之一基础部分</a></li>
                        
                          <li><a title="iOS开发-如何优雅地集成支付宝支付功能" href="14702334322974.html">iOS开发-如何优雅地集成支付宝支付功能</a></li>
                        
                          <li><a title="iOS开发中，m3u8格式视频的下载缓存" href="14685880528825.html">iOS开发中，m3u8格式视频的下载缓存</a></li>
                        
                          <li><a title="git中，如何使用sourcetree管理同一个项目中的多个远程仓库" href="14634059724558.html">git中，如何使用sourcetree管理同一个项目中的多个远程仓库</a></li>
                        
                          <li><a title="iOS开发-坑爹的iOS特性" href="14611524452165.html">iOS开发-坑爹的iOS特性</a></li>
                        
                          <li><a title="iOS开发-打通UIWebView和WKWebView的Cookie" href="14611518603473.html">iOS开发-打通UIWebView和WKWebView的Cookie</a></li>
                        
                          <li><a title="iOS开发-apple pay的实际应用" href="14611508828436.html">iOS开发-apple pay的实际应用</a></li>
                        
                          <li><a title="iOS开发-navigationBar的透明度处理" href="14610809561335.html">iOS开发-navigationBar的透明度处理</a></li>
                        
                          <li><a title="iOS开发-AVPlayer的缓存问题" href="14608134723455.html">iOS开发-AVPlayer的缓存问题</a></li>
                        
                          <li><a title="iOS开发-OC可选参数函数" href="14608131201401.html">iOS开发-OC可选参数函数</a></li>
                        
                          <li><a title="iOS开发-FMDB多线程安全问题" href="14608133210368.html">iOS开发-FMDB多线程安全问题</a></li>
                        

                    
                      <li class="side-title"><span>Python</span></li>
                        
                          <li><a title="一个导出qq音乐歌单的小工具" href="14913069118493.html">一个导出qq音乐歌单的小工具</a></li>
                        
                          <li><a title="Python学习笔记-函数的使用" href="14890625223406.html">Python学习笔记-函数的使用</a></li>
                        
                          <li><a title="Python学习笔记-基础篇" href="14695444360650.html">Python学习笔记-基础篇</a></li>
                        

                    
                      <li class="side-title"><span>OpenCV</span></li>
                        
                          <li><a title="苍老师的 "码" 是怎么打上的" href="15090278092045.html">苍老师的 "码" 是怎么打上的</a></li>
                        

                    
                      <li class="side-title"><span>Java</span></li>
                        
                          <li><a title="JAVA动态代理" href="15377761043880.html">JAVA动态代理</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 


	
		<div class="markdown-body">
		<h1>iOS逆向开发笔记1--工具篇</h1>

		<h4 id="toc_0">文档更新说明</h4>

<ul>
<li><p>2017年01月26日 v1.0 初稿</p>
<p>平时我们做的开发一把是正向开发，所谓逆向开发，实际上有个更加通俗的词语，就是破解，逆向开发可以让我们了解到其他<code>APP</code>的实现方式，学到正向开发学不到的东西。</p>
<h2 id="toc_1">工具列表</h2></li>
<li><p>电脑端</p>
<ul>
<li><a href="https://github.com/theos/theos">theos</a>：基于命令行的逆向开发工具</li>
<li><a href="https://github.com/alexzielenski/optool">optool</a>：二进制文件注入工具</li>
<li><a href="https://github.com/DanTheMan827/ios-app-signer">ios-app-signer</a>：iOS签名工具</li>
</ul></li>
<li><p>手机端</p>
<ul>
<li><a href="https://github.com/KJCracks/Clutch">clutch</a>：iOS上面砸壳的榔头（需要越狱的iOS设备）</li>
</ul>
<h2 id="toc_2">安装theos</h2>
<p><a href="https://github.com/theos/theos">theos</a>是一款逆向开发工具，可以为我们搭建逆向开发的脚手架，编译逆向工程等等，非常实用。</p>
<h3 id="toc_3">theos的准备</h3>
<p><code>theos</code>是需要依赖一些第三方库的：</p>
<ul>
<li>curl</li>
<li>git</li>
<li>make</li>
<li>openssh</li>
<li>perl</li>
<li>rsync</li>
<li>dpkg</li>
<li>python</li>
</ul>
<p>在<code>Mac</code>上，<code>theos</code>的依赖基本上都自带了，我们只需要额外安装<code>dpkg</code></p></li>
<li><p><code>dpkg</code>的安装：<code>dpkg</code>可以使用<code>homebrew</code>安装，当然，<code>homebrew</code>也是需要另外安装的，没有<code>homebrew</code>的可以去官网看看安装方法。安装完<code>homebrew</code>之后，使用命令:<code>brew install dpkg</code>安装<code>dpkg</code></p></li>
</ul>

<h4 id="toc_4">theos的安装</h4>

<ol>
<li>打开命令行</li>
<li><p>选择要存放theos的位置，官方建议是放在<code>/opt/theos</code>目录下，实际我们可以根据自己的需求，我就习惯放在<code>home</code>里面的<code>workspace</code>目录下</p>
<blockquote>
<p>不建议放在当前用户权限之外的目录，否则可能会引起权限问题</p>
</blockquote>
<pre><code class="language-bash"># 这一句的意思是定义一个名称为THEOS的变量，指向我们的theos安装目录
# 定义完之后，我们可以在命令行中以 $THEOS 的方式使用这个变量<br/>
export THEOS=~/workspace/crack/theos
</code></pre></li>
<li><p>把<code>theos</code>的最新版本代码克隆到本地</p>
<ul>
<li><p>使用<code>git</code></p>
<pre><code class="language-bash"># --recursive参数表示递归克隆子模块，theos中有子仓库，我们需要一并克隆下来
git clone --recursive git://github.com/DHowett/theos.git $THEOS
</code></pre></li>
<li><p>使用<code>svn</code></p>
<pre><code class="language-bash">svn co http://svn.howett.net/svn/theos/trunk $THEOS
</code></pre></li>
</ul></li>
<li><p>给命令行添加默认变量定义</p>
<blockquote>
<p>在<code>Mac</code>中，<code>~/.bash_profile</code>文件中的命令会在命令行打开的时候自动运行一遍</p>
</blockquote>
<p>我们可以在<code>~/.bash_profile</code>文件中添加我们需要定义的一些变量，方便后面的开发。<br/>
打开<code>~/.bash_profile</code>文件，在里面添加下面代码。</p>
<pre><code class="language-bash"># theos存放位置
export THEOS=~/workspace/crack/theos<br/>
# 把theos里面的添加到path环境变量<br/>
export PATH=$THEOS/bin:$PATH<br/>
# 越狱机器的IP和ssh端口需要根据自己的网络环境做修改<br/>
export THEOS_DEVICE_IP=example.local THEOS_DEVICE_PORT=22
</code></pre></li>
<li><p>复制越狱手机里面的<code>/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate</code>到<code>$THEOS/lib</code>，重命名为<code>libsubstrate.dylib</code>。</p></li>
<li><p>同样的步骤，复制越狱手机里面的<code>/Library/Frameworks/CydiaSubstrate.framework/Headers/CydiaSubstrate.h</code>到电脑的<code>$THEOS/include</code>目录下，并重命名为<code>substrate.h</code>。</p>
<blockquote>
<p>如果没有越狱手机，也可以从网上下载下来，下载方法如下：<br/>
如果已经完成了5、6步，直接跳过下面这段代码。</p>
</blockquote>
<pre><code class="language-bash"># 下载文件
wget http://apt.saurik.com/debs/mobilesubstrate_0.9.6011_iphoneos-arm.deb<br/>
# 新建一个文件夹<br/>
mkdir substrate<br/>
# 把下载的文件解包<br/>
dpkg-deb -x mobilesubstrate_*_iphoneos-arm.deb substrate<br/>
# 移动第5步提到的文件<br/>
mv substrate/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate $THEOS/lib/libsubstrate.dylib<br/>
# 移动第6步的文件<br/>
mv substrate/Library/Frameworks/CydiaSubstrate.framework/Headers/CydiaSubstrate.h $THEOS/include/substrate.h
</code></pre></li>
</ol>

<p>至此，我们就把<code>theos</code>安装到了电脑里面，可以在命令行中输入<code>$THEOS/bin/nic.pl</code>来测试一下是否安装成功。</p>

<h2 id="toc_5">安装optool</h2>

<p><a href="https://github.com/alexzielenski/optool">optool</a>是一个可以修改和插入MatchO格式可执行文件<code>load commands</code>段的开源工具。我们可以利用这个工具，把我们生成的<code>hook</code>库插入到目标可执行文件中。</p>

<ol>
<li><p>克隆源代码到本地；</p>
<pre><code class="language-bash">git clone --recursive https://github.com/alexzielenski/optool.git
</code></pre></li>
<li><p>编译源代码，生成可执行文件；</p>
<pre><code class="language-bash">cd optool
xcodebuild -project optool.xcodeproj -configuration Release ARCHS=&quot;x86_64&quot; build
</code></pre>
<blockquote>
<p>注意：如果这一步遇到error: There is no SDK with the name or path &#39;/Users/fengqiang/workspace/crack/optool/macosx10.9&#39;这个错误，是由于工程的依赖SDK版本设置不对，工程默认使用的是10.9的SDK，我们只需要用xcode打开工程，在build setting中，把Base SDK设置成Latest macOS即可</p>
</blockquote></li>
<li><p>把编译出来的可执行文件添加到<code>/usr/local/bin</code>目录下，这样我们就可以直接在命令行中使用了。</p>
<pre><code class="language-bash">cp build/Release/optool /usr/local/bin/
</code></pre></li>
<li><p>在命令行中输入<code>optool -v</code>，测试一下，如看到版本信息说明就没问题了，至此，<code>optool</code>安装完成。</p></li>
</ol>

<h2 id="toc_6">安装ios-app-signer</h2>

<p><a href="https://github.com/DanTheMan827/ios-app-signer">ios-app-signer</a>是一个<code>APP</code>签名工具，非常直观方便，安装也是非常简单，这里我们直接下载作者编译好的<code>Release</code>版本吧。</p>

<ol>
<li>打开<a href="https://github.com/DanTheMan827/ios-app-signer/releases">Realse</a>页面，下载最新版本的<code>iOS.App.Signer.app.zip</code>；</li>
<li>解压之后，拖到<code>应用程序</code>目录下，在<code>Launch Pad</code>中打开即可。</li>
</ol>

<h2 id="toc_7">安装clutch</h2>

<p>上面都是安装在电脑上使用的工具，接下来我们安装一个手机上面使用的工具。<br/>
<a href="https://github.com/KJCracks/Clutch">clutch</a>是<code>iOS</code>越狱环境下的一个砸壳工具，由于上传到<code>Appstore</code>里面的<code>APP</code>经过了苹果的加密，我们要做逆向，就必须先解密，<code>clutch</code>就是这个解密的工具，可以称之为“榔头”。</p>

<p>clutch可以通过下载源代码自己编译，也可以下载作者已经编译好的<code>release</code>版本，这里我们就克隆源代码，然后自己编译吧。</p>

<p>1.克隆源代码到本地；</p>

<pre><code class="language-bash">git clone https://github.com/KJCracks/Clutch.git
</code></pre>

<p>2.关闭<code>xcode</code>的SDK强制签名；</p>

<pre><code class="language-bash">killall Xcode
# 备份一份要修改的文件
cp /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist ~/
/usr/libexec/PlistBuddy -c &quot;Set :DefaultProperties:CODE_SIGNING_REQUIRED NO&quot; /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist
/usr/libexec/PlistBuddy -c &quot;Set :DefaultProperties:AD_HOC_CODE_SIGNING_ALLOWED YES&quot; /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist
</code></pre>

<p>3.编译下载下来的源码；</p>

<pre><code class="language-bash">xcodebuild -project Clutch.xcodeproj -configuration Release ARCHS=&quot;armv7 armv7s arm64&quot; build
</code></pre>

<p>4.将生成出来的二进制文件复制到已经越狱的设备中</p>

<pre><code class="language-bash">scp build/clutch root@&lt;your.device.ip&gt;:/usr/bin/
</code></pre>

<p>5.可以在越狱设备上面执行<code>clutch -i</code>，测试一下是否已经安装成功，如果看到了已经安装的<code>app</code>的话，代表安装成功了。</p>

<h2 id="toc_8">小结</h2>

<p>经过上面几个步骤，我们就已经搭建好了一个越狱开发的基本环境，接下来要做的事情就是开始真正的越狱开发了。</p>

<h2 id="toc_9">参考资料：</h2>

<ol>
<li><a href="http://www.swiftyper.com/2016/12/26/wechat-redenvelop-tweak-for-non-jailbroken-iphone/">免越狱版 iOS 抢红包插件</a></li>
</ol>


		</div>
	

 
	

 
	

 
	

 
	

  
  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
