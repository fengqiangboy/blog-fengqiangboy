<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  奉强的个人博客
  
  </title>
 <meta name="description" content="奉强的技术博客，全栈开发。">
 <link href="atom.xml" rel="alternate" title="奉强的个人博客" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">奉强的个人博客</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 奉强的个人博客</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>杂类</label></li>

          
            <li><a title="基于docker搭建lanproxy内网穿透服务" href="15229403526064.html">基于docker搭建lanproxy内网穿透服务</a></li>
          
            <li><a title="手摸手教程 之 教你搭建自己的静态博客" href="14993449096811.html">手摸手教程 之 教你搭建自己的静态博客</a></li>
          
            <li><a title="我的2016" href="14854433400635.html">我的2016</a></li>
          
            <li><a title="支付宝怎么免手续费提现" href="14786196059653.html">支付宝怎么免手续费提现</a></li>
          
            <li><a title="怎么用自己的域名建立一个个人博客" href="14607325165802.html">怎么用自己的域名建立一个个人博客</a></li>
          
            <li><a title="嵌入式和单片机的学习心得" href="14939112243125.html">嵌入式和单片机的学习心得</a></li>
          

      
        <li class="divider"></li>
        <li><label>iOS开发</label></li>

          
            <li><a title="iOS逆向开发笔记1--工具篇" href="14854248394653.html">iOS逆向开发笔记1--工具篇</a></li>
          
            <li><a title="Swift3入门教程之二----函数和闭包" href="14758321095435.html">Swift3入门教程之二----函数和闭包</a></li>
          
            <li><a title="Swift3入门教程之一基础部分" href="14758046879967.html">Swift3入门教程之一基础部分</a></li>
          
            <li><a title="iOS开发-如何优雅地集成支付宝支付功能" href="14702334322974.html">iOS开发-如何优雅地集成支付宝支付功能</a></li>
          
            <li><a title="iOS开发中，m3u8格式视频的下载缓存" href="14685880528825.html">iOS开发中，m3u8格式视频的下载缓存</a></li>
          
            <li><a title="git中，如何使用sourcetree管理同一个项目中的多个远程仓库" href="14634059724558.html">git中，如何使用sourcetree管理同一个项目中的多个远程仓库</a></li>
          
            <li><a title="iOS开发-坑爹的iOS特性" href="14611524452165.html">iOS开发-坑爹的iOS特性</a></li>
          
            <li><a title="iOS开发-打通UIWebView和WKWebView的Cookie" href="14611518603473.html">iOS开发-打通UIWebView和WKWebView的Cookie</a></li>
          
            <li><a title="iOS开发-apple pay的实际应用" href="14611508828436.html">iOS开发-apple pay的实际应用</a></li>
          
            <li><a title="iOS开发-navigationBar的透明度处理" href="14610809561335.html">iOS开发-navigationBar的透明度处理</a></li>
          
            <li><a title="iOS开发-AVPlayer的缓存问题" href="14608134723455.html">iOS开发-AVPlayer的缓存问题</a></li>
          
            <li><a title="iOS开发-OC可选参数函数" href="14608131201401.html">iOS开发-OC可选参数函数</a></li>
          
            <li><a title="iOS开发-FMDB多线程安全问题" href="14608133210368.html">iOS开发-FMDB多线程安全问题</a></li>
          

      
        <li class="divider"></li>
        <li><label>Python</label></li>

          
            <li><a title="一个导出qq音乐歌单的小工具" href="14913069118493.html">一个导出qq音乐歌单的小工具</a></li>
          
            <li><a title="Python学习笔记-函数的使用" href="14890625223406.html">Python学习笔记-函数的使用</a></li>
          
            <li><a title="Python学习笔记-基础篇" href="14695444360650.html">Python学习笔记-基础篇</a></li>
          

      
        <li class="divider"></li>
        <li><label>OpenCV</label></li>

          
            <li><a title="苍老师的 "码" 是怎么打上的" href="15090278092045.html">苍老师的 "码" 是怎么打上的</a></li>
          

      
        <li class="divider"></li>
        <li><label>Java</label></li>

          
            <li><a title="spring-boot 整合 Redis 缓存" href="15557268417313.html">spring-boot 整合 Redis 缓存</a></li>
          
            <li><a title="JAVA动态代理" href="15377761043880.html">JAVA动态代理</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>杂类</span></li>
                        
                          <li><a title="基于docker搭建lanproxy内网穿透服务" href="15229403526064.html">基于docker搭建lanproxy内网穿透服务</a></li>
                        
                          <li><a title="手摸手教程 之 教你搭建自己的静态博客" href="14993449096811.html">手摸手教程 之 教你搭建自己的静态博客</a></li>
                        
                          <li><a title="我的2016" href="14854433400635.html">我的2016</a></li>
                        
                          <li><a title="支付宝怎么免手续费提现" href="14786196059653.html">支付宝怎么免手续费提现</a></li>
                        
                          <li><a title="怎么用自己的域名建立一个个人博客" href="14607325165802.html">怎么用自己的域名建立一个个人博客</a></li>
                        
                          <li><a title="嵌入式和单片机的学习心得" href="14939112243125.html">嵌入式和单片机的学习心得</a></li>
                        

                    
                      <li class="side-title"><span>iOS开发</span></li>
                        
                          <li><a title="iOS逆向开发笔记1--工具篇" href="14854248394653.html">iOS逆向开发笔记1--工具篇</a></li>
                        
                          <li><a title="Swift3入门教程之二----函数和闭包" href="14758321095435.html">Swift3入门教程之二----函数和闭包</a></li>
                        
                          <li><a title="Swift3入门教程之一基础部分" href="14758046879967.html">Swift3入门教程之一基础部分</a></li>
                        
                          <li><a title="iOS开发-如何优雅地集成支付宝支付功能" href="14702334322974.html">iOS开发-如何优雅地集成支付宝支付功能</a></li>
                        
                          <li><a title="iOS开发中，m3u8格式视频的下载缓存" href="14685880528825.html">iOS开发中，m3u8格式视频的下载缓存</a></li>
                        
                          <li><a title="git中，如何使用sourcetree管理同一个项目中的多个远程仓库" href="14634059724558.html">git中，如何使用sourcetree管理同一个项目中的多个远程仓库</a></li>
                        
                          <li><a title="iOS开发-坑爹的iOS特性" href="14611524452165.html">iOS开发-坑爹的iOS特性</a></li>
                        
                          <li><a title="iOS开发-打通UIWebView和WKWebView的Cookie" href="14611518603473.html">iOS开发-打通UIWebView和WKWebView的Cookie</a></li>
                        
                          <li><a title="iOS开发-apple pay的实际应用" href="14611508828436.html">iOS开发-apple pay的实际应用</a></li>
                        
                          <li><a title="iOS开发-navigationBar的透明度处理" href="14610809561335.html">iOS开发-navigationBar的透明度处理</a></li>
                        
                          <li><a title="iOS开发-AVPlayer的缓存问题" href="14608134723455.html">iOS开发-AVPlayer的缓存问题</a></li>
                        
                          <li><a title="iOS开发-OC可选参数函数" href="14608131201401.html">iOS开发-OC可选参数函数</a></li>
                        
                          <li><a title="iOS开发-FMDB多线程安全问题" href="14608133210368.html">iOS开发-FMDB多线程安全问题</a></li>
                        

                    
                      <li class="side-title"><span>Python</span></li>
                        
                          <li><a title="一个导出qq音乐歌单的小工具" href="14913069118493.html">一个导出qq音乐歌单的小工具</a></li>
                        
                          <li><a title="Python学习笔记-函数的使用" href="14890625223406.html">Python学习笔记-函数的使用</a></li>
                        
                          <li><a title="Python学习笔记-基础篇" href="14695444360650.html">Python学习笔记-基础篇</a></li>
                        

                    
                      <li class="side-title"><span>OpenCV</span></li>
                        
                          <li><a title="苍老师的 "码" 是怎么打上的" href="15090278092045.html">苍老师的 "码" 是怎么打上的</a></li>
                        

                    
                      <li class="side-title"><span>Java</span></li>
                        
                          <li><a title="spring-boot 整合 Redis 缓存" href="15557268417313.html">spring-boot 整合 Redis 缓存</a></li>
                        
                          <li><a title="JAVA动态代理" href="15377761043880.html">JAVA动态代理</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 


	
		<div class="markdown-body">
		<h1>iOS开发-navigationBar的透明度处理</h1>

		<h3 id="toc_0">文档更新说明：</h3>

<pre><code class="language-text">•   2016年02月25日 v1.0  初稿
</code></pre>

<h2 id="toc_1">1、背景</h2>

<p><img src="media/14610809561335/1.png" alt="1" class="mw_img_left" style="width:315px;display: block; float: left; margin: 0px 8px 8px 0px;"/><img src="media/14610809561335/2.png" alt="2" class="mw_img_left" style="width:315px;display: block; float: left; margin: 0px 8px 8px 0px;"/><br/>
<div style="clear:left;"></div><br/>
我们在使用app的时候，经常看到一些app的导航栏的透明度是可以变化的。比如说淘宝，在商品界面，你越往上滑，导航栏的透明度就会降低，那么这种效果是怎么实现的呢？效果图如上.</p>

<h2 id="toc_2">实现方案</h2>

<p>很多人看到这个效果，都觉得很简单，确实，这个效果看起来是蛮简单的。这里我想到的方案主要是下面的四个：</p>

<ul>
<li>方案1：可能你会认为设置导航栏的透明度就可以解决了。不过设置导航栏透明度是会把导航栏上面那几个按钮一并隐藏的，再看看淘宝，那几个按钮可是一直都在啊。还有就是目前iOS中，设置导航栏透明度是有问题的，这个不上今天的主题，下次有机会再来讨论。</li>
<li>方案2：这个方案要看具体项目了，项目中如果使用的是纯色来作为导航栏背景的话，我们可以调整导航栏背景颜色的透明度达到这个效果。但是非常不幸的是，设置这个属性是没有用的。这个属性只能设置两个状态，一个是有颜色的，一个是没有颜色的（clearColor）。</li>
<li>方案3：看完上面两个方案，也许你会在心中默念“尼玛，这不坑爹吗？两个方案一个不能实现，一个只能用在纯色的导航栏上面，我们公司的美工坑爹的要我们用图片作为导航栏背景！！！”。先别急，待我慢慢说来。从上面方案二可以想到一种思路，就是先把背景图片的透明度设置好，再把这个图片设置成导航栏的背景图片。不过，图片是没有alpha这个属性的，我们可以通过画布的方式来实现这个透明度的改变，具体代码在下面给出。</li>
<li>方案4：这个方案是一个做假象的做法，先给导航栏设置一个透明的背景，然后在创建一个和导航栏一样大小的view，把这个view  insert到导航栏的0号位置中，这样可以保证我们创建的view在导航栏的最底层，不影响上层的按钮显示。</li>
</ul>

<h2 id="toc_3">相关代码</h2>

<p>光说不练假把式，方案说完了，不去实现一下就没意思了。<br/>
<strong>方案1</strong>：这个方案没什么技术含量，直接在scrollView的代理中写一句话就可以了。不过要注意这个方案的缺陷。</p>

<pre><code class="language-text">- (void)scrollViewDidScroll:(UIScrollView *)scrollView {
    //改变透明度
    self.navigationController.navigationBar.alpha = scrollView.contentOffset.y / 200.0f;
}
</code></pre>

<p><strong>方案2</strong>：暂时未实现，实现了再来贴代码。 <br/>
<strong>方案3</strong>：这个方案主要就是生成透明度变化的图片。</p>

<ul>
<li> 1、首先，设置导航栏默认背景图片。</li>
</ul>

<pre><code class="language-text">- (void)setNavigation {
    //设置导航栏背景颜色
    UIImage *navigationBarBackgroundImage = [UIImage imageFromColor:[UIColor redColor] imageSize:CGSizeMake(WIDTH, 64)];
    navigationBarBackgroundImage = [UIImage imageByApplyingAlpha:0 image:navigationBarBackgroundImage];
    [self.navigationController.navigationBar setBackgroundImage:navigationBarBackgroundImage forBarMetrics:UIBarMetricsDefault];
    
    self.automaticallyAdjustsScrollViewInsets = NO;
}
</code></pre>

<ul>
<li>2、实现代理，在代理中改变图片透明度。</li>
</ul>

<pre><code class="language-text">#pragma mark scrollViewDelegate
- (void)scrollViewDidScroll:(UIScrollView *)scrollView {
    //设置导航栏背景透明度
    CGFloat alpha = (scrollView.contentOffset.y / 200.0f);
    alpha = alpha &lt; 0 ? 0 : alpha &gt; 1 ? 1 : alpha;
    
    UIImage *navigationBarBackgroundImage = [UIImage imageFromColor:[UIColor redColor] imageSize:CGSizeMake(WIDTH, 64)];
    navigationBarBackgroundImage = [UIImage imageByApplyingAlpha:alpha image:navigationBarBackgroundImage];
    [self.navigationController.navigationBar setBackgroundImage:navigationBarBackgroundImage forBarMetrics:UIBarMetricsDefault];
}
</code></pre>

<p>功能就可以实现了。还有两段关键代码。生成纯色图片和改变图片透明度的。</p>

<ul>
<li>生成纯色图片</li>
</ul>

<pre><code class="language-text">/**
 *  通过颜色生成纯色图片
 *
 *  @param color 颜色
 *  @param size  图片大小
 *
 *  @return 生成的图片
 */
+ (UIImage *)imageFromColor:(UIColor *)color imageSize:(CGSize)size {
    CGRect rect = CGRectMake(0, 0, size.width, size.height);
    UIGraphicsBeginImageContext(size);
    CGContextRef context = UIGraphicsGetCurrentContext();
    CGContextSetFillColorWithColor(context, [color CGColor]);
    CGContextFillRect(context, rect);
    UIImage *img = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext(); return img;
}
</code></pre>

<ul>
<li>改变图片透明度</li>
</ul>

<pre><code class="language-text">/**
 *  改变图片透明度
 *
 *  @param alpha 透明度
 *  @param image 图片
 *
 *  @return 改变之后的图片
 */
 + (UIImage *)imageByApplyingAlpha:(CGFloat)alpha image:(UIImage*)image {
    
    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0.0f);
    
    CGContextRef ctx = UIGraphicsGetCurrentContext();
    CGRect area = CGRectMake(0, 0, image.size.width, image.size.height);
    
    CGContextScaleCTM(ctx, 1, -1);
    CGContextTranslateCTM(ctx, 0, -area.size.height);
    
    CGContextSetBlendMode(ctx, kCGBlendModeMultiply);
    
    CGContextSetAlpha(ctx, alpha);
    
    CGContextDrawImage(ctx, area, image.CGImage);
    
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
    
    UIGraphicsEndImageContext();
    
    return newImage;
}
</code></pre>

<p><strong>方案4</strong>：这个方案关键点是找到navigaitonbar的底层图片，然后把我们的view插入进去。</p>

<ul>
<li>1、首先，把我们的view直接插入到navigaitonbar的0号位置。</li>
</ul>

<pre><code class="language-text">#pragma mark 设置导航栏
- (void)setNavigation {
    //设置导航栏背景颜色
    UIImage *navigationBarBackgroundImage = [UIImage imageFromColor:[UIColor redColor] imageSize:CGSizeMake(WIDTH, 64)];
    navigationBarBackgroundImage = [UIImage imageByApplyingAlpha:0 image:navigationBarBackgroundImage];
    [self.navigationController.navigationBar setBackgroundImage:navigationBarBackgroundImage forBarMetrics:UIBarMetricsDefault];
    
    self.automaticallyAdjustsScrollViewInsets = NO;
    
    
    //创建一个假象背景view
    UIView *navigationBarBackgroundView = [[UIView alloc] initWithFrame:CGRectMake(0, -20, WIDTH, 64)];
    navigationBarBackgroundView.alpha = 0;
    navigationBarBackgroundView.backgroundColor = [UIColor orangeColor];
    //插入
    [self.navigationController.navigationBar insertSubview:navigationBarBackgroundView atIndex:0];
}﻿
</code></pre>

<ul>
<li>2、然后就和上面的方案一样了，在代理中改变这个view的透明度.</li>
</ul>

<pre><code class="language-text">#pragma mark scrollViewDelegate
- (void)scrollViewDidScroll:(UIScrollView *)scrollView {
    //设置导航栏背景透明度
    CGFloat alpha = (scrollView.contentOffset.y / 300.0f);
    alpha = alpha &lt; 0 ? 0 : alpha &gt; 1 ? 1 : alpha;
    
    UIView *navigationBarBackgroundView = self.navigationController.navigationBar.subviews[0];
    navigationBarBackgroundView.alpha = alpha;
}
</code></pre>

<p> <em>说明</em>：这个方案我觉得最好是自己写一个navigationController的继承类，在继承类中实现这个功能。</p>

<h2 id="toc_4">项目代码</h2>

<p>项目完整代码已经上传到github，有兴趣的可以下载下来看看效果，也欢迎大家指出其中的错误，如果你有更好的方案也希望能告诉我~<br/>
项目地址：<a href="https://github.com/fengqiangboy/iOS-NavigationBarBackgroundAlpha">https://github.com/fengqiangboy/iOS-NavigationBarBackgroundAlpha</a></p>


		</div>
	

 
	

 
	

 
	

 
	

  
  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
